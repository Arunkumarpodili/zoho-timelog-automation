name: Zoho Daily Time Log

on:
  schedule:
    # 11:00 AM IST = 05:30 UTC
    - cron: "30 5 * * 2-6"
  workflow_dispatch:

jobs:
  zoho-time:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Run Zoho Time Logger
        id: zoho
        env:
          ZOHO_CLIENT_ID: ${{ secrets.ZOHO_CLIENT_ID }}
          ZOHO_CLIENT_SECRET: ${{ secrets.ZOHO_CLIENT_SECRET }}
          ZOHO_REFRESH_TOKEN: ${{ secrets.ZOHO_REFRESH_TOKEN }}
          ZOHO_DC: ${{ secrets.ZOHO_DC }}
          ZOHO_PORTAL_ID: ${{ secrets.ZOHO_PORTAL_ID }}
          ZOHO_PROJECT_ID: ${{ secrets.ZOHO_PROJECT_ID }}
          ZOHO_TASK_ID: ${{ secrets.ZOHO_TASK_ID }}
          ZOHO_USER_ID: ${{ secrets.ZOHO_USER_ID }}
          ZOHO_BILL_STATUS: ${{ secrets.ZOHO_BILL_STATUS }}
          ZOHO_TIME_START: ${{ secrets.ZOHO_TIME_START }}
          ZOHO_TIME_END: ${{ secrets.ZOHO_TIME_END }}
          ZOHO_TIMEZONE: ${{ secrets.ZOHO_TIMEZONE }}
          ZOHO_NOTES_PREFIX: ${{ secrets.ZOHO_NOTES_PREFIX }}
        run: python scripts/zoho_log_time.py

      # -----------------------
      # SEND SUCCESS EMAIL
      # -----------------------
      - name: Send success email
        if: success()
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: ${{ secrets.SMTP_SERVER }}
          server_port: ${{ secrets.SMTP_PORT }}
          username: ${{ secrets.SMTP_USERNAME }}
          password: ${{ secrets.SMTP_PASSWORD }}
          from: ${{ secrets.MAIL_FROM }}
          to: ${{ secrets.MAIL_TO }}
          subject: "✅ Zoho Time Log Success"
          body: |
            Zoho time log entry created successfully.

            Repository: ${{ github.repository }}
            Workflow:   Zoho Daily Time Log
            Run ID:     ${{ github.run_id }}
            Trigger:    ${{ github.event_name }}

            Please verify in Zoho Projects → Timesheets.

      # -----------------
